<!DOCTYPE html>
<html lang="en" class="light">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Talabat Delay Calculator</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts: Poppins for headings, Lato for body, Caveat for handwriting -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@600;700;800&family=Lato:wght@400;700&family=Caveat:wght@700&display=swap" rel="stylesheet">
    <!-- Three.js for 3D background -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <!-- FontAwesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <script>
        // Custom Tailwind configuration
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        'sans': ['Lato', 'sans-serif'],
                        'heading': ['Poppins', 'sans-serif'],
                        'handwriting': ['Caveat', 'cursive'],
                    },
                    colors: {
                        'primary': '#5E56F8', 'primary-hover': '#4338ca',
                        'secondary': '#1A202C', 'secondary-hover': '#2D3748',
                        'background': '#F7F8FC', 'card': 'rgba(255, 255, 255, 0.8)',
                        'text-primary': '#1A202C', 'text-secondary': '#718096',
                        'border': '#E2E8F0', 'dark-primary': '#7F7AFF',
                        'dark-primary-hover': '#9592FF', 'dark-secondary': '#E2E8F0',
                        'dark-secondary-hover': '#F7FAFC', 'dark-background': '#121212',
                        'dark-card': 'rgba(26, 26, 26, 0.7)', 'dark-text-primary': '#F7FAFC',
                        'dark-text-secondary': '#A0AEC0', 'dark-border': '#2D3748',
                    }
                }
            }
        }
    </script>
    <style>
        /* Base styles and dynamic effects */
        @keyframes fadeInUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes glow { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }
        @keyframes aurora { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }
        @keyframes pulse-glow { 0%, 100% { box-shadow: 0 0 15px 0px rgba(94, 86, 248, 0.4); } 50% { box-shadow: 0 0 30px 5px rgba(94, 86, 248, 0.6); } }
        .dark .logo-glow { animation-name: pulse-glow-dark; }
        @keyframes pulse-glow-dark { 0%, 100% { box-shadow: 0 0 15px 0px rgba(127, 122, 255, 0.4); } 50% { box-shadow: 0 0 30px 5px rgba(127, 122, 255, 0.6); } }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        @keyframes popFade { 0% { transform: scale(0.95) translateY(20px); opacity: 0; } 60% { transform: scale(1.05) translateY(-5px); opacity: 1; } 100% { transform: scale(1) translateY(0); opacity: 1; } }
        @keyframes scroll { 0% { transform: translateX(100%); } 100% { transform: translateX(-100%); } }


        #bg-canvas { position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; z-index: -1; }
        body::before {
            content: ''; position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;
            background: linear-gradient(125deg, #5E56F8, #a855f7, #D946EF, #f472b6, #FBBF24, #4ade80);
            background-size: 1000% 1000%; animation: aurora 30s ease infinite; z-index: -2; opacity: 0.1;
        }
        .dark body::before { opacity: 0.15; }

        .animate-fadeInUp { animation: fadeInUp 0.6s ease-out forwards; }
        .glass-card { backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.1); }
        .logo-glow { border-radius: 9999px; animation: pulse-glow 4s infinite ease-in-out; }
        .glowing-line {
            height: 3px; width: 150px;
            background: linear-gradient(90deg, transparent, #5E56F8, #D946EF, #5E56F8, transparent);
            background-size: 200% 100%; animation: glow 4s linear infinite;
        }
        .dark .glowing-line { background: linear-gradient(90deg, transparent, #7F7AFF, #F472B6, #7F7AFF, transparent); background-size: 200% 100%; }

        /* Themed styles for form elements */
        .form-input, select {
            background-color: rgba(255, 255, 255, 0.7) !important;
            border: 1px solid #E2E8F0 !important;
            border-radius: 0.5rem;
            transition: all 0.2s ease-in-out;
        }
        .dark .form-input, .dark select {
            background-color: rgba(40, 40, 40, 0.7) !important;
            border-color: #2D3748 !important;
            color: #f1f1f1;
        }
        .form-input:focus, select:focus {
            box-shadow: 0 0 0 3px rgba(94, 86, 248, 0.4);
            border-color: #5E56F8 !important;
            outline: none;
        }
        .dark .form-input:focus, .dark select:focus {
             box-shadow: 0 0 0 3px rgba(127, 122, 255, 0.4);
            border-color: #7F7AFF !important;
        }
        .form-label { font-weight: bold; display: block; text-align: left; margin-bottom: 0.5rem; }
        
        .service-option input[type="checkbox"]:checked + label,
        .order-type-option input[type="radio"]:checked + label {
            background-color: #5E56F8; color: white; border-color: #4338ca;
        }
        .dark .service-option input[type="checkbox"]:checked + label,
        .dark .order-type-option input[type="radio"]:checked + label {
            background-color: #7F7AFF; color: #121212; border-color: #9592FF;
        }

        /* Floating Panels and Buttons */
        .floating-panel {
            position: fixed;
            width: 280px;
            padding: 1rem;
            border-radius: 1rem;
            box-shadow: 0 8px 32px rgba(0,0,0,0.25);
            z-index: 1000;
            transition: transform 0.5s ease-in-out;
        }
        #failedTrials { top: 25%; left: 32px; transform: translateX(-150%); }
        #failedTrials.show { transform: translateX(0); }
        #timeCalculator { top: 25%; right: 32px; transform: translateX(150%); }
        #timeCalculator.show { transform: translateX(0); }
        #refundSlaPanel { bottom: 80px; left: 32px; transform: translateX(-150%); }
        #refundSlaPanel.show { transform: translateX(0); }

        .floating-btn {
            position: fixed; z-index: 1001; width: 56px; height: 56px;
            border-radius: 50%; border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 4px 16px rgba(0,0,0,0.2);
            font-size: 1.5rem; display: flex; align-items: center; justify-content: center;
            cursor: pointer; transition: all 0.2s ease;
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
        }
        .dark .floating-btn {
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .floating-btn:hover { 
            transform: scale(1.1); 
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
        }
        #toggleFailedTrialsBtn { top: 15%; left: 32px; background-color: rgba(239, 68, 68, 0.7); color: white; }
        #toggleTimeCalcBtn { top: 15%; right: 32px; background-color: rgba(59, 130, 246, 0.7); color: white; }
        #toggleRefundSlaBtn { bottom: 20px; left: 32px; background-color: rgba(245, 158, 11, 0.7); color: white; }
        #toggleFailedTrialsBtn:hover { background-color: rgba(220, 38, 38, 0.9); }
        #toggleTimeCalcBtn:hover { background-color: rgba(37, 99, 235, 0.9); }
        #toggleRefundSlaBtn:hover { background-color: rgba(217, 119, 6, 0.9); }

        .marquee {
            position: fixed; bottom: 0; left: 0; width: 100%; z-index: 999;
            background-color: var(--secondary); color: white;
            padding: 0.5rem 0; overflow: hidden; white-space: nowrap;
        }
        .dark .marquee { background-color: var(--dark-secondary); color: var(--dark-background); }
        .marquee-text { display: inline-block; padding-left: 100%; animation: scroll 60s linear infinite; }
    </style>
</head>
<body class="bg-background text-text-primary dark:bg-dark-background dark:text-dark-text-primary font-sans antialiased">
    <!-- Back to Home Button -->
    <a href="index.html" title="Back to Tool Hub" class="fixed top-4 right-4 z-[5000] h-7 w-7 bg-card dark:bg-dark-card rounded-full shadow-lg flex items-center justify-center text-primary dark:text-dark-primary hover:bg-gray-200 dark:hover:bg-gray-700 transform transition-all duration-300 hover:scale-110">
        <i class="fas fa-arrow-left text-lg"></i>
    </a>

    <canvas id="bg-canvas"></canvas>

    <div class="container mx-auto p-4 sm:p-6 lg:p-8 max-w-4xl relative z-10">
        
        <header class="relative flex flex-col justify-center items-center mb-8 sm:mb-12 animate-fadeInUp" style="animation-delay: 100ms;">
            <div class="logo-glow sm:absolute sm:top-0 sm:left-0 mb-4 sm:mb-0">
                <img src="https://i.ibb.co/TxmWmdRd/image.png" alt="Primary Logo" class="h-16 w-16" onerror="this.onerror=null;this.src='https://placehold.co/64x64/5E56F8/FFFFFF?text=Logo';">
            </div>
            <div class="text-center">
                <h1 class="text-2xl sm:text-3xl font-extrabold font-heading text-text-primary dark:text-dark-text-primary tracking-tight">
                    Talabat <span class="text-primary dark:text-dark-primary">Delay Calculator</span>
                </h1>
                <div class="glowing-line mt-3 mx-auto"></div>
            </div>
            <button id="theme-toggle" class="absolute top-0 right-0 p-2 rounded-full text-text-secondary dark:text-dark-text-secondary hover:bg-gray-200 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-primary dark:focus:ring-dark-primary transition-transform duration-300">
                <svg id="theme-toggle-light-icon" class="w-6 h-6 hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path></svg>
                <svg id="theme-toggle-dark-icon" class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path></svg>
            </button>
        </header>

        <main class="bg-card dark:bg-dark-card p-6 sm:p-8 rounded-2xl shadow-2xl glass-card animate-fadeInUp" style="animation-delay: 200ms;">
            <div class="max-w-md mx-auto">
                <div class="flex justify-end mb-4">
                    <button class="bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded-lg text-sm" onclick="resetFormFields(0)">
                        <i class="fas fa-sync-alt mr-2"></i>Reset
                    </button>
                </div>
                <div class="space-y-4">
                    <div>
                        <label for="chatStart" class="form-label">Chat Start Time:</label>
                        <input type="text" id="chatStart" class="form-input w-full p-2" placeholder="21.01.2025, 05:10 PM" />
                    </div>
                    <div>
                        <label for="orderPlacing" class="form-label">Order Placing Time:</label>
                        <input type="text" id="orderPlacing" class="form-input w-full p-2" placeholder="Apr 19, 2025 05:18 PM" />
                    </div>
                    <div>
                        <label for="orderDelivery" class="form-label">Delivery Time (in minutes):</label>
                        <input type="number" id="orderDelivery" class="form-input w-full p-2" placeholder="75" />
                    </div>
                    <div class="service-selection grid grid-cols-2 gap-2">
                        <div class="service-option">
                            <input type="checkbox" id="tmp" name="compGroup" value="tmp" class="hidden" />
                            <label for="tmp" class="block border-2 border-border dark:border-dark-border rounded-lg p-3 text-center cursor-pointer">TMP</label>
                        </div>
                        <div class="service-option">
                            <input type="checkbox" id="tgo" name="compGroup" value="tgo" class="hidden" />
                            <label for="tgo" class="block border-2 border-border dark:border-dark-border rounded-lg p-3 text-center cursor-pointer">TGO & Tmart</label>
                        </div>
                    </div>
                    <div id="fvNfvSelection" class="hidden mt-4">
                        <label class="form-label">Order Type:</label>
                        <div class="order-type-selection grid grid-cols-2 gap-2">
                            <div class="order-type-option">
                                <input type="radio" id="fv" name="orderType" value="fv" class="hidden" />
                                <label for="fv" class="block border-2 border-border dark:border-dark-border rounded-lg p-3 text-center cursor-pointer">FV & tMart</label>
                            </div>
                            <div class="order-type-option">
                                <input type="radio" id="nfv" name="orderType" value="nfv" class="hidden" />
                                <label for="nfv" class="block border-2 border-border dark:border-dark-border rounded-lg p-3 text-center cursor-pointer">NFV</label>
                            </div>
                        </div>
                    </div>
                    <button id="calculateBtn" class="w-full bg-primary text-white font-bold py-3 px-6 rounded-lg shadow-lg disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                        Check Order Status
                    </button>
                    <div id="result" class="text-center font-bold text-lg p-4 rounded-lg hidden"></div>
                </div>
            </div>
        </main>

        <footer class="flex flex-col sm:flex-row items-center justify-between mt-10 text-center animate-fadeInUp" style="animation-delay: 300ms;">
            <div class="logo-glow">
                <img src="https://i.ibb.co/WvcTtbST/image.png" alt="Secondary Logo" class="h-10" onerror="this.onerror=null;this.src='https://placehold.co/120x40/5E56F8/FFFFFF?text=Logo';">
            </div>
            <div class="font-handwriting text-xl text-text-secondary dark:text-dark-text-secondary mt-4 sm:mt-0">
                <p>Designed By Omar & Ahmed</p>
            </div>
        </footer>
    </div>
    
    <!-- Floating Panels -->
    <div id="failedTrials" class="floating-panel glass-card bg-card dark:bg-dark-card">
        <h3 class="font-bold text-lg mb-2 text-red-500"><i class="fas fa-phone-slash mr-2"></i>Failed Trials</h3>
        <ul class="list-disc list-inside text-sm space-y-1">
            <li>All Circuits are busy</li>
            <li>Silent Call</li>
            <li>Error Message (Wrong/Incomplete number)</li>
            <li>Beep once tone</li>
            <li>Call dropped</li>
        </ul>
    </div>

    <div id="timeCalculator" class="floating-panel glass-card bg-card dark:bg-dark-card">
        <h3 class="font-bold text-lg mb-2 text-primary dark:text-dark-primary"><i class="fas fa-plus-circle mr-2"></i>Add 10 Minutes</h3>
        <label for="endTimeInput" class="text-sm">End Time (e.g., 10:25 AM):</label>
        <input type="text" id="endTimeInput" class="form-input w-full p-2 mt-1 mb-2" placeholder="10:25 AM" />
        <button id="timeCalcBtn" class="w-full bg-primary text-white font-bold py-2 px-4 rounded-lg text-sm">Calculate</button>
        <div id="timeCalcResult" class="mt-2 text-center font-bold"></div>
    </div>
    
    <div id="refundSlaPanel" class="floating-panel glass-card bg-card dark:bg-dark-card">
        <h3 class="font-bold text-lg mb-2 text-amber-500"><i class="fas fa-receipt mr-2"></i>Refund SLA</h3>
        <select id="paymentMethodSelect" class="form-input w-full p-2">
            <option value="" disabled selected>Select Payment Method</option>
            <option value="CreditCardKNet">Credit Card/K-Net (Not EG/OM)</option>
            <option value="CreditCardEgypt">Credit Card (Egypt)</option>
            <option value="Qpay">Qpay (Qatar)</option>
            <option value="Benefit">Benefit (Bahrain)</option>
            <option value="ApplePay">Apple Pay (All Countries)</option>
            <option value="CreditCardOman">Credit Card (Oman)</option>
        </select>
        <div id="refundSlaDetails" class="mt-2 text-xs p-2 bg-background/50 dark:bg-dark-background/50 rounded hidden">
            <p id="compensationScript"></p>
        </div>
    </div>

    <!-- Floating Action Buttons -->
    <button id="toggleFailedTrialsBtn" class="floating-btn" title="Toggle Failed Trials Panel"><i class="fas fa-phone-slash"></i></button>
    <button id="toggleTimeCalcBtn" class="floating-btn" title="Toggle Time Calculator"><i class="fas fa-calculator"></i></button>
    <button id="toggleRefundSlaBtn" class="floating-btn" title="Toggle Refund SLA Panel"><i class="fas fa-receipt"></i></button>

    <!-- Marquee -->
    <div class="marquee">
        <div class="marquee-text">
            ğŸš¨ If the delay on RST Contact Driver Should be (restaurant hasn't started preparing the food) Check Late Owner ğŸš¨ Refresh the Hurrier every now and then ğŸš¨ If the amount more than (180AED) in UAE (No Refund/No partial refund/No compensation) send the case to EXPO ğŸš¨ Contact drivers - Customer asks about refund: Refund query, Refund action taken by you: Refund request ğŸš¨Online Payment Issues -- First contact from customer: Online Payment Issue ğŸš¨| Customer contacted before SLA: Follow up on existing case ğŸš¨| Case needs to go to R&V team: Online Payment Issue ğŸš¨| Case already with R&V team: Follow up on existing case ğŸš¨| Customer unaware of incomplete order: Online Payment Issue ğŸš¨| Voucher Issues: Customer aware order was incomplete: Voucher already used ğŸš¨| Customer not eligible: Voucher already used ğŸš¨| Customer didn't receive voucher: Voucher not received ğŸš¨
        </div>
    </div>

    <script>
    document.addEventListener("DOMContentLoaded", function () {
        // --- THEME & 3D BACKGROUND LOGIC ---
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({ canvas: document.querySelector('#bg-canvas'), alpha: true });
        renderer.setPixelRatio(window.devicePixelRatio);
        renderer.setSize(window.innerWidth, window.innerHeight);
        camera.position.setZ(30);
        const shapes = [];
        function createShapes() {
            shapes.forEach(s => scene.remove(s));
            shapes.length = 0;
            const isDark = document.documentElement.classList.contains('dark');
            const color = isDark ? 0x7F7AFF : 0x5E56F8;
            const material = new THREE.MeshBasicMaterial({ color, wireframe: true });
            const geometries = [new THREE.BoxGeometry(5, 5, 5), new THREE.TetrahedronGeometry(5), new THREE.OctahedronGeometry(5), new THREE.IcosahedronGeometry(5)];
            for (let i = 0; i < 50; i++) {
                const geometry = geometries[Math.floor(Math.random() * geometries.length)];
                const shape = new THREE.Mesh(geometry, material);
                const [x, y, z] = Array(3).fill().map(() => THREE.MathUtils.randFloatSpread(100));
                shape.position.set(x, y, z);
                const [rx, ry, rz] = Array(3).fill().map(() => Math.random() * 0.01 - 0.005);
                shape.userData.rotation = { x: rx, y: ry, z: rz };
                shapes.push(shape);
                scene.add(shape);
            }
        }
        function animate() {
            requestAnimationFrame(animate);
            shapes.forEach(shape => {
                shape.rotation.x += shape.userData.rotation.x;
                shape.rotation.y += shape.userData.rotation.y;
            });
            renderer.render(scene, camera);
        }
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });
        const themeToggleBtn = document.getElementById('theme-toggle');
        const lightIcon = document.getElementById('theme-toggle-light-icon');
        const darkIcon = document.getElementById('theme-toggle-dark-icon');
        const applyTheme = (theme) => {
            if (theme === 'dark') {
                document.documentElement.classList.add('dark');
                lightIcon.classList.remove('hidden');
                darkIcon.classList.add('hidden');
            } else {
                document.documentElement.classList.remove('dark');
                lightIcon.classList.add('hidden');
                darkIcon.classList.remove('hidden');
            }
            setTimeout(createShapes, 100);
        };
        themeToggleBtn.addEventListener('click', () => {
            const newTheme = document.documentElement.classList.contains('dark') ? 'light' : 'dark';
            localStorage.setItem('theme', newTheme);
            applyTheme(newTheme);
        });
        const savedTheme = localStorage.getItem('theme') || (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
        applyTheme(savedTheme);
        createShapes();
        animate();

        // --- APPLICATION LOGIC ---
        const calculateBtn = document.getElementById("calculateBtn");
        const chatStartInput = document.getElementById("chatStart");
        const orderPlacingInput = document.getElementById("orderPlacing");
        const orderDeliveryInput = document.getElementById("orderDelivery");
        const resultDiv = document.getElementById("result");
        const fvNfvSelection = document.getElementById("fvNfvSelection");
        const serviceCheckboxes = document.querySelectorAll('input[name="compGroup"]');
        const orderTypeRadios = document.querySelectorAll('input[name="orderType"]');

        function updateCalculateButtonState() {
            const serviceSelected = document.querySelector('input[name="compGroup"]:checked');
            const orderTypeSelected = document.querySelector('input[name="orderType"]:checked');
            let enable = false;

            if (serviceSelected) {
                if (serviceSelected.value === "tmp" || serviceSelected.value === "tgo") {
                    enable = !!orderTypeSelected;
                } else {
                    enable = true;
                }
            }
            calculateBtn.disabled = !enable;
        }

        serviceCheckboxes.forEach(checkbox => {
            checkbox.addEventListener("change", function () {
                if (this.checked) {
                    serviceCheckboxes.forEach(cb => { if (cb !== this) cb.checked = false; });
                }
                if (this.value === "tmp" || this.value === "tgo") {
                    fvNfvSelection.classList.remove('hidden');
                } else {
                    fvNfvSelection.classList.add('hidden');
                    orderTypeRadios.forEach(r => r.checked = false);
                }
                updateCalculateButtonState();
            });
        });

        orderTypeRadios.forEach(radio => {
            radio.addEventListener("change", updateCalculateButtonState);
        });
        
        calculateBtn.addEventListener('click', calculateDelay);

        function parseTime(input) {
            let match = input.match(/(\d{2})\.(\d{2})\.(\d{4}),\s*(\d{1,2}):(\d{2})\s*(AM|PM)/i);
            if (match) {
                const [, day, month, year, hour, minute, period] = match;
                return new Date(`${year}-${month}-${day} ${hour}:${minute} ${period}`);
            }
            if (Date.parse(input)) { return new Date(input); }
            return null;
        }

        function calculateDelay() {
            const chatTime = parseTime(chatStartInput.value.trim());
            const orderTime = parseTime(orderPlacingInput.value.trim());
            const deliveryMins = parseFloat(orderDeliveryInput.value);

            if (!chatTime || !orderTime || isNaN(deliveryMins)) {
                resultDiv.textContent = "Invalid input. Please check all fields.";
                resultDiv.style.backgroundColor = "#ef4444";
                resultDiv.classList.remove('hidden');
                return;
            }

            const actualDeliveryTime = new Date(orderTime.getTime() + deliveryMins * 60 * 1000);
            const delay = (chatTime - actualDeliveryTime) / (1000 * 60);

            let status = "", color = "";
            if (delay < 0) {
                status = `âœ” On Time: No delay (${Math.abs(delay).toFixed(0)} mins early)`;
                color = "#22c55e";
            } else {
                status = `âš  Delayed by ${delay.toFixed(0)} minutes`;
                if (delay <= 10) color = "#f59e0b";
                else if (delay <= 20) color = "#f97316";
                else color = "#ef4444";
            }
            resultDiv.textContent = status;
            resultDiv.style.backgroundColor = color;
            resultDiv.classList.remove('hidden');
        }

        window.resetFormFields = (timeout = 0) => {
            chatStartInput.value = "";
            orderPlacingInput.value = "";
            orderDeliveryInput.value = "";
            serviceCheckboxes.forEach(cb => cb.checked = false);
            orderTypeRadios.forEach(r => r.checked = false);
            fvNfvSelection.classList.add('hidden');
            resultDiv.classList.add('hidden');
            updateCalculateButtonState();
        };
        
        // --- Floating Panels Logic ---
        document.getElementById('toggleFailedTrialsBtn').addEventListener('click', () => {
            document.getElementById('failedTrials').classList.toggle('show');
        });
        document.getElementById('toggleTimeCalcBtn').addEventListener('click', () => {
            document.getElementById('timeCalculator').classList.toggle('show');
        });
        document.getElementById('toggleRefundSlaBtn').addEventListener('click', () => {
            document.getElementById('refundSlaPanel').classList.toggle('show');
        });

        // Add 10 Minutes Calculator Logic
        document.getElementById('timeCalcBtn').addEventListener('click', () => {
            const timeInput = document.getElementById('endTimeInput').value.trim();
            const resultEl = document.getElementById('timeCalcResult');
            const parsedTime = parseTime(`01.01.2025, ${timeInput}`); // Use dummy date for parsing
            if (parsedTime) {
                parsedTime.setMinutes(parsedTime.getMinutes() + 10);
                const hours = parsedTime.getHours() % 12 || 12;
                const minutes = parsedTime.getMinutes().toString().padStart(2, '0');
                const period = parsedTime.getHours() >= 12 ? 'PM' : 'AM';
                resultEl.textContent = `New Time: ${hours}:${minutes} ${period}`;
            } else {
                resultEl.textContent = "Invalid time format";
            }
        });

        // Refund SLA Logic
        document.getElementById('paymentMethodSelect').addEventListener('change', function() {
            const slaDetails = document.getElementById('refundSlaDetails');
            const scriptEl = document.getElementById('compensationScript');
            const slaData = {
                CreditCardKNet: "5-7", CreditCardEgypt: "2-7", Qpay: "7-21",
                Benefit: "5-7", ApplePay: "3", CreditCardOman: "5-7",
            };
            const slaDays = slaData[this.value];
            if (slaDays) {
                let scriptText = this.value === "CreditCardOman" 
                    ? "Ù‡Ù„ ØªØ±ÙŠØ¯ Ù…Ù†ÙŠ Ø£Ù† Ø£Ø¹ÙŠØ¯ Ù…Ø¨Ù„Øº Ø·Ù„Ø¨Ùƒ Ø¥Ù„Ù‰ Ø±ØµÙŠØ¯ Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ Ø¹Ù„Ù‰ Ø§Ù„ÙÙˆØ±ØŒ ÙÙ‡Ùˆ Ø±ØµÙŠØ¯ ÙÙŠ Ø­Ø³Ø§Ø¨Ùƒ Ø¹Ù„Ù‰ Ø·Ù„Ø¨Ø§Øª ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ø³ØªØ®Ø¯Ø§Ù…Ù‡ Ù„Ù„Ø·Ù„Ø¨ Ù…Ù† Ø£ÙŠ Ù…Ø·Ø¹Ù… ÙŠÙ‚Ø¨Ù„ Ø§Ù„Ø¯ÙØ¹ Ø§Ù„Ø§Ù„ÙƒØªØ±ÙˆÙ†ÙŠÂ  Ø£Ùˆ Ø£Ù… Ø£Ù† ÙŠØªÙ… Ø±Ø¯Ù‡ Ø¹Ù„Ù‰ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¨Ù†ÙƒÙŠ ÙÙŠ Ø®Ù„Ø§Ù„ SLA ÙŠÙˆÙ… Ø¹Ù…Ù„ØŸ"
                    : "Ù‡Ù„ ØªØ±ÙŠØ¯ Ù…Ù†ÙŠ Ø£Ù† Ø£Ø¹ÙŠØ¯ Ù…Ø¨Ù„Øº Ø·Ù„Ø¨Ùƒ Ø¥Ù„Ù‰ Ø±ØµÙŠØ¯ Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ Ø¹Ù„Ù‰ Ø§Ù„ÙÙˆØ±ØŒ ÙÙ‡Ùˆ Ø±ØµÙŠØ¯ ÙÙŠ Ø­Ø³Ø§Ø¨Ùƒ Ø¹Ù„Ù‰ Ø·Ù„Ø¨Ø§Øª ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ø³ØªØ®Ø¯Ø§Ù…Ù‡ Ù„Ù„Ø·Ù„Ø¨ Ù…Ù† Ø£ÙŠ Ù…Ø·Ø¹Ù… ÙŠÙ‚Ø¨Ù„ Ø§Ù„Ø¯ÙØ¹ Ø§Ù„Ø§Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ÙˆØªÙ†ØªÙ‡ÙŠ ØµÙ„Ø§Ø­ÙŠØªÙ‡ Ø¨Ø¹Ø¯ 12 Ø´Ù‡Ø± Ø£Ùˆ Ø£Ù… Ø£Ù† ÙŠØªÙ… Ø±Ø¯Ù‡ Ø¹Ù„Ù‰ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¨Ù†ÙƒÙŠ ÙÙŠ Ø®Ù„Ø§Ù„ SLA ÙŠÙˆÙ… Ø¹Ù…Ù„ØŸ";
                scriptEl.textContent = scriptText.replace("SLA", slaDays);
                slaDetails.classList.remove('hidden');
            } else {
                slaDetails.classList.add('hidden');
            }
        });
    });
    </script>
</body>
</html>
